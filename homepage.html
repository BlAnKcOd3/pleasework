<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>De Anza Marketplace</title>
    <!-- Load FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- CSS START: Applying the new Style --- */
        
        /* General Page Reset */
        body {
            margin: 0;
            padding: 0;
            background-color: #f0ce55; /* Gold/Mustard background */
            font-family: Arial, Helvetica, sans-serif;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* Header Section */
        header {
            background-color: #4f090c; /* Dark Red */
            padding: 15px 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            height: 80px;
            box-sizing: border-box;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }

        h1 {
            color: white;
            font-size: 3rem;
            margin: 0;
            font-weight: bold;
            text-align: center;
        }

        /* Profile Icon Style (Using the blue circle style from your example) */
        #userIcon {
            position: absolute;
            right: 20px;
            color: #3b82f6; /* Light blue color */
            font-size: 3rem;
            cursor: pointer;
            background-color: white;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s;
        }
        
        #userIcon:hover {
            transform: scale(1.05);
        }

        /* Main Content Container */
        .container {
            width: 100%;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            flex: 1;
        }

        /* Action Bar (Sell/Buy Buttons + Search) */
        .action-bar {
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            margin-bottom: 30px;
            margin-top: 10px;
            gap: 20px;
            flex-wrap: wrap;
        }

        .btn-pill {
            background-color: white;
            border: 3px solid black;
            border-radius: 20px; /* Pill shape */
            padding: 5px 0;
            width: 200px;
            text-align: center;
            font-size: 2rem;
            font-weight: bold;
            color: black;
            cursor: pointer;
            box-shadow: 4px 4px 8px rgba(0,0,0,0.2);
            transition: transform 0.1s, background-color 0.1s;
        }
        
        .btn-pill:active {
            transform: translateY(2px);
            box-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        /* Search Container */
        .search-container {
            display: flex;
            align-items: center;
        }

        /* Hidden Search Input */
        #search-input {
            display: none;
            font-size: 1.5rem;
            padding: 5px 10px;
            border: 3px solid black;
            border-radius: 15px;
            width: 250px; /* Wider input */
            margin-right: 10px;
            outline: none;
            transition: width 0.3s ease-in-out;
        }
        
        #search-input.visible {
            display: block;
        }

        /* Search Icon Style */
        .search-icon {
            font-size: 3rem;
            color: black;
            cursor: pointer;
        }

        /* Grid Layout for Categories */
        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); /* Responsive columns */
            gap: 20px;
            padding-bottom: 40px;
        }

        .category-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        
        .category-item:hover {
            opacity: 0.85;
        }

        /* White Box for Icons */
        .icon-box {
            background-color: white;
            border: 3px solid black;
            border-radius: 25px;
            width: 100%;
            aspect-ratio: 1 / 1;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 10px;
            box-shadow: 3px 3px 6px rgba(0,0,0,0.15);
            transition: transform 0.2s;
        }
        
        .icon-box:hover {
            transform: scale(1.05);
        }

        /* Styles for the FontAwesome Icons inside the boxes */
        .icon-box i {
            font-size: 5rem; /* Make icons large */
        }

        /* Specific Colors for Icons */
        .color-red { color: #8B0000; }
        .color-gold { color: #DAA520; }
        .color-brown { color: #654321; }

        .category-label {
            font-weight: bold;
            font-size: 1.1rem;
            color: #000;
            line-height: 1.2;
        }

        /* Footer */
        footer {
            background-color: #4f090c;
            height: 40px;
            width: 100%;
            margin-top: auto;
        }

        @media (max-width: 768px) {
            h1 { font-size: 2.5rem; }
            .category-grid { grid-template-columns: repeat(2, 1fr); }
            .action-bar { flex-direction: column; gap: 15px; }
            .btn-pill { width: 80%; }
            
            /* Reposition search icon/input for mobile */
            .search-container { 
                width: 80%; 
                justify-content: space-between;
            }
            #search-input {
                width: 100%;
            }
            .search-icon { 
                font-size: 2.5rem;
            }
            #userIcon { width: 40px; height: 40px; font-size: 2.5rem; }
        }
        
        /* --- CSS END --- */
    </style>
    
    <!-- Firebase SDK Imports (Needed for Auth State Check on Profile Click) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        // Note: Firestore imports removed as listings are not displayed on this style of homepage

        // --- Configuration and Initialization ---
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        if (!firebaseConfig) {
            console.error("Firebase configuration is missing. Cannot initialize app.");
            // Proceed without Firebase if config is missing, but auth features won't work.
        } else {
             // Initialize Firebase
            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);

            // --- Initial Sign-In (Custom Token for Canvas Environment) ---
            if (initialAuthToken) {
                signInWithCustomToken(auth, initialAuthToken).catch(e => {
                    console.error("Custom Auth Token Sign-In failed:", e);
                    // Fallback to anonymous sign-in if custom token fails
                    signInAnonymously(auth).catch(e => {
                        console.error("Anonymous Sign-In failed during fallback:", e);
                    });
                });
            } else {
                // Sign in anonymously if no custom token is provided
                signInAnonymously(auth).catch(e => {
                    console.error("Anonymous Sign-In failed:", e);
                });
            }

            // --- Event Listeners for Authentication and Navigation ---
            const userIcon = document.getElementById('userIcon');
            if (userIcon) {
                userIcon.addEventListener('click', () => {
                     // Use onAuthStateChanged to check if the user is currently signed in
                     onAuthStateChanged(auth, (user) => {
                        if (user) {
                            // User is signed in, redirect to dashboard/account management
                            window.location.href = 'dashboard.html';
                        } else {
                            // User is not signed in, redirect to the login page
                            window.location.href = 'login.html';
                        }
                    }, { once: true });
                });
            }
            
            // Wire up the 'Sell' button
            const sellButton = document.getElementById('sellButton');
            if (sellButton) {
                sellButton.addEventListener('click', () => {
                    // Redirect to the sell page
                    window.location.href = 'sell.html'; 
                });
            }
            
            // Wire up the 'Buy' button (which effectively just clicks a category or stays here)
            const buyButton = document.getElementById('buyButton');
            if (buyButton) {
                buyButton.addEventListener('click', () => {
                    // For now, the Buy button just scrolls to the categories
                    document.getElementById('categoryGrid').scrollIntoView({ behavior: 'smooth' });
                });
            }
        }
        
        // --- General App Functions (Non-Firebase) ---
        
        // Toggles the visibility of the search input
        window.toggleSearch = function() {
            var searchInput = document.getElementById("search-input");
            var isVisible = searchInput.classList.toggle('visible');
            
            if (isVisible) {
                searchInput.focus();
            } else {
                // Optionally clear search if hidden
                searchInput.value = ''; 
            }
        }
        
        // Handles category clicks (redirect to a filtered listings page, like listings.html?category=...)
        window.navigateToCategory = function(categoryName) {
             console.log("Navigating to category:", categoryName);
             // Since we don't have a separate 'listings.html' yet, we'll log for now,
             // but this would typically redirect: 
             // window.location.href = 'listings.html?category=' + encodeURIComponent(categoryName);
             
             // For simplicity in this project flow, we'll currently use a placeholder logic:
             // In a full application, this would redirect to a page showing items.
             alert(`Showing items for: ${categoryName}`);
        }
        
    </script>
</head>
<body>

    <!-- HEADER -->
    <header>
        <h1>De Anza Exchange</h1>
        <!-- Account Icon -->
        <div id="userIcon" class="header-icon">
            <i class="fas fa-user-circle"></i>
        </div>
    </header>

    <div class="container">
        
        <!-- ACTION BAR -->
        <div class="action-bar">
            <div class="btn-pill" id="sellButton">Sell</div>
            <div class="btn-pill" id="buyButton">Buy</div>
            
            <!-- Search Section -->
            <div class="search-container">
                <input type="text" id="search-input" placeholder="Search items...">
                <!-- Search Loop Icon, triggers toggleSearch function -->
                <i class="fas fa-search search-icon" onclick="toggleSearch()"></i>
            </div>
        </div>

        <!-- GRID CATEGORIES -->
        <div class="category-grid" id="categoryGrid">
            
            <!-- Item 1: Textbooks -->
            <div class="category-item" onclick="navigateToCategory('Textbooks')">
                <div class="icon-box">
                    <i class="fas fa-book color-red"></i>
                </div>
                <div class="category-label">Textbooks</div>
            </div>

            <!-- Item 2: Supplies -->
            <div class="category-item" onclick="navigateToCategory('Study Supplies')">
                <div class="icon-box">
                    <i class="fas fa-pencil-ruler color-gold"></i>
                </div>
                <div class="category-label">Study Supplies</div>
            </div>

            <!-- Item 3: Electronics -->
            <div class="category-item" onclick="navigateToCategory('Electronics')">
                <div class="icon-box">
                    <i class="fas fa-laptop color-red"></i>
                </div>
                <div class="category-label">Electronics</div>
            </div>

            <!-- Item 4: Bikes -->
            <div class="category-item" onclick="navigateToCategory('Bikes and Outdoors')">
                <div class="icon-box">
                    <i class="fas fa-motorcycle color-red"></i>
                </div>
                <div class="category-label">Bikes & Outdoors</div>
            </div>

            <!-- Item 5: Housing -->
            <div class="category-item" onclick="navigateToCategory('Housing')">
                <div class="icon-box">
                    <i class="fas fa-home color-brown"></i>
                </div>
                <div class="category-label">Housing<br>& Roommates</div>
            </div>

            <!-- Item 6: Services -->
            <div class="category-item" onclick="navigateToCategory('Services')">
                <div class="icon-box">
                    <i class="fas fa-tools color-red"></i>
                </div>
                <div class="category-label">Services<br>& Rentals</div>
            </div>

            <!-- Item 7: Jobs -->
            <div class="category-item" onclick="navigateToCategory('Student Jobs')">
                <div class="icon-box">
                    <i class="fas fa-briefcase color-brown"></i>
                </div>
                <div class="category-label">Student<br>Jobs</div>
            </div>

            <!-- Item 8: Events -->
            <div class="category-item" onclick="navigateToCategory('Events')">
                <div class="icon-box">
                    <i class="fas fa-bell color-gold"></i>
                </div>
                <div class="category-label">Events &<br>Campus Activities</div>
            </div>

        </div>
    </div>

    <!-- FOOTER -->
    <footer></footer>

</body>
</html>