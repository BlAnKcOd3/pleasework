<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>De Anza Marketplace</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body data-page="marketplace">
  <header class="header">
    <h1>De Anza Marketplace</h1>
    <div id="userIcon" class="icon" title="Your account"><i class="fas fa-user-circle"></i></div>
  </header>

  <div class="container">
    <div class="action-bar">
      <div id="sellButton" class="pill" onclick="location.href='sell.html'">Sell</div>
      <div id="buyButton" class="pill" onclick="location.href='listings.html'">Buy</div>

      <div class="search-container" style="margin-left:10px;">
        <input id="search-input" placeholder="Search items..." />
        <i id="search-toggle" class="fas fa-search search-icon" onclick="toggleSearch()"></i>
      </div>
    </div>

    <div class="category-grid">
      <div class="category-item" data-cat="textbooks">
        <div class="icon-box" data-cat="textbooks"><i class="fas fa-book color-gold"></i></div>
        <div class="cat-label">Textbooks</div>
      </div>

      <div class="category-item" data-cat="study-supplies">
        <div class="icon-box" data-cat="study-supplies"><i class="fas fa-pencil-ruler color-red"></i></div>
        <div class="cat-label">Study Supplies</div>
      </div>

      <div class="category-item" data-cat="electronics">
        <div class="icon-box" data-cat="electronics"><i class="fas fa-laptop color-red"></i></div>
        <div class="cat-label">Electronics</div>
      </div>

      <div class="category-item" data-cat="bikes">
        <div class="icon-box" data-cat="bikes"><i class="fas fa-bicycle color-red"></i></div>
        <div class="cat-label">Bikes & Outdoors</div>
      </div>

      <div class="category-item" data-cat="housing">
        <div class="icon-box" data-cat="housing"><i class="fas fa-home color-brown"></i></div>
        <div class="cat-label">Housing & Roommates</div>
      </div>

      <div class="category-item" data-cat="services">
        <div class="icon-box" data-cat="services"><i class="fas fa-tools color-red"></i></div>
        <div class="cat-label">Services & Rentals</div>
      </div>

      <div class="category-item" data-cat="jobs">
        <div class="icon-box" data-cat="jobs"><i class="fas fa-briefcase color-brown"></i></div>
        <div class="cat-label">Student Jobs</div>
      </div>

      <div class="category-item" data-cat="events">
        <div class="icon-box" data-cat="events"><i class="fas fa-bell color-gold"></i></div>
        <div class="cat-label">Events & Campus Activities</div>
      </div>
    </div>
  </div>

  <footer class="site-footer">
    <p>&copy; 2025 De Anza Marketplace</p>
  </footer>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    
    // Global variables (provided by Canvas environment)
    const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
    
    let auth;

    // --- Firebase Setup ---

// --- Firebase Configuration ---
        const firebaseConfig = {
            apiKey: "AIzaSyBJJYUOM8EBEuT39DX2F_HtxgEbHDRH-Zc",
            authDomain: "deanzahacks11-21-2025.firebaseapp.com",
            projectId: "deanzahacks11-21-2025",
            storageBucket: "deanzahacks11-21-2025.firebasestorage.app",
            messagingSenderId: "253702257130",
            appId: "1:253702257130:web:9ea8e3ee1bd291f1801a93",
            measurementId: "G-5B84R81S31"
        };

    function setupFirebase() {
        if (!firebaseConfig) {
            console.error("Firebase configuration is missing. Cannot initialize app.");
            return;
        }
        const app = initializeApp(firebaseConfig);
        auth = getAuth(app);

        // Initial sign-in for Canvas environment
        if (initialAuthToken) {
            signInWithCustomToken(auth, initialAuthToken).catch(e => {
                console.error("Custom Auth Token Sign-In failed:", e);
                signInAnonymously(auth).catch(e => {
                    console.error("Anonymous Sign-In failed:", e);
                });
            });
        } else {
            signInAnonymously(auth).catch(e => {
                console.error("Anonymous Sign-In failed:", e);
            });
        }
    }

    // --- Event Handlers ---
    window.toggleSearch = function() {
        var searchInput = document.getElementById("search-input");
        searchInput.classList.toggle('visible');
        if (searchInput.classList.contains('visible')) {
            searchInput.focus();
        }
    }
    
    // Event listener for user icon click
    document.getElementById('userIcon').addEventListener('click', () => {
         onAuthStateChanged(auth, (user) => {
            window.location.href = user ? 'dashboard.html' : 'login.html';
        }, { once: true });
    });

    // --- NEW: Category Click Handler ---
    document.querySelectorAll('.category-item').forEach(item => {
        item.addEventListener('click', (event) => {
            // Find the data-cat attribute on the item itself or its icon-box child
            const category = item.getAttribute('data-cat');
            if (category) {
                // Redirect to listings.html and pass the category as a query parameter
                window.location.href = `listings.html?category=${category}`;
            }
        });
    });

    // --- Initialization ---
    window.onload = setupFirebase;

  </script>
</body>
</html>